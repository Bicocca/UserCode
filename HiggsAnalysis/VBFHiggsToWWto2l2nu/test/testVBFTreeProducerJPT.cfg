process testTreeProducerJPT = {


    include "HiggsAnalysis/VBFHiggsToWWto2l2nu/data/allEleIds.cfi"
    

    service = MessageLogger {}

    module refResolver = AmbResolverRef 
      {
        InputTag src = pixelMatchGsfElectrons
        bool filter = false
      }


    module MCEventProducer = VBFMCEventProducer
      {
	InputTag mcSourceInputTag     = source
	InputTag genParticlesInputTag = genParticleCandidates
      }


 module EvInfoProducer = VBFEvInfoProducer
      {
	InputTag TriggerInputTag     = 	TriggerResults::HLT
	InputTag PrimVertexInputTag   =  offlinePrimaryVerticesFromCTFTracks
	InputTag VertexInputTag      =  pixelVertices::HLT //Rec1 ?? 							
      }


    module TrackProducer = VBFTrackProducer
      {
        InputTag trackInputTag = ctfWithMaterialTracks
      }


    //------------------------------------------------------------
    // vvvvv Jet Met Cor vvvvv

    include "JetMETCorrections/Modules/data/JetMETCorrections.cff"
    include "JetMETCorrections/MCJet/data/ZSPJetCorrectionsSpring07.cff"
    include "JetMETCorrections/JetPlusTrack/data/JetPlusTrackCorrections.cff"
    
    sequence vbfJetCorrections = 
      {
	  MCJetCorJetIcone5
	, ZSPJetCorJetIcone5 
//	, JetPlusTrackZSPCorJetIcone5 
//          -> No "IdealMagneticFieldRecord" record found in the EventSetup.
//          -> Please add an ESSource or ESProducer that delivers such a record.
//          -> cms::Exception going through module JetCorrectionProducer/JetPlusTrackZSPCorJetIcone5
       }


    module rawJetProducer = VBFJetProducer
      {
        InputTag jetInputTag = iterativeCone5CaloJets::Rec1
      }


    module MCCorJetProducer = VBFJetProducer
      {
        InputTag jetInputTag = MCJetCorJetIcone5::testTreeProducerJPT
      }


    module ZSPJetCorJetProducer = VBFJetProducer
      {
        InputTag jetInputTag = ZSPJetCorJetIcone5::testTreeProducerJPT
      }


    module JetPlusTrackZSPCorJetProducer = VBFJetProducer
      {
        InputTag jetInputTag = JetPlusTrackZSPCorJetIcone5::testTreeProducerJPT
      }

    sequence vbfJetProducers = 
      {
	  rawJetProducer
	, MCCorJetProducer
	, ZSPJetCorJetProducer
//	, JetPlusTrackZSPCorJetProducer
      }



    module corMetType1ZSP = Type1MET
      {
	string metType = "CaloMET"
      	string inputUncorMetLabel  = "met"
      	string inputUncorJetsLabel = "iterativeCone5CaloJets"
      	string corrector           = "ZSPJetCorrectorIcone5"
      	double jetPTthreshold      = 20.0
      	double jetEMfracLimit      = 0.9
      }

    module corMetType1JetPlusTrack = Type1MET
      {
      string metType = "CaloMET"
      string inputUncorMetLabel  = "corMetType1ZSP"
      string inputUncorJetsLabel = "ZSPJetCorJetIcone5"
      string corrector           = "JetPlusTrackZSPCorrectorIcone5"
      double jetPTthreshold      = 20.0
      double jetEMfracLimit      = 0.9
      }


    module vbfMuCorRawMet = VBFMetCorrector
      {
  	InputTag CaloMetLabel = met
  	InputTag MuonLabel    = muonProducer:mergedMuons
 	bool MuonCorrection   = true
 	bool MuonDepositCor   = true
  	double MuonPtMin      = 5
  	double MuonEtaMax     = 2.5
  	double MuonTrackD0Max = 999.0 //PG not used
  	double MuonTrackDzMax = 999.0 //PG not used
  	double MuonNHitsMin   = 5     //PG not used
  	double MuonDPtMax     = 0.5   //PG not used
  	double MuonChiSqMax   = 1000  //PG not used
  	double CorrMetMin     = 5   
      }


    module hwwMuCorRawMet  = HWWMetCorrector
      {
        InputTag CaloMetLabel = met
        InputTag MuonLabel    = muons       
        bool MuonCorrection   = true
        bool MuonDepositCor   = true
        double MuonPtMin      = 5
        double MuonEtaMax     = 2.5
        double MuonTrackD0Max = 999.0
        double MuonTrackDzMax = 999.0
        double MuonNHitsMin   = 5
        double MuonDPtMax     = 0.5
        double MuonChiSqMax   = 1000
        double CorrMetMin     = 5   
      }


    module vbfMuCorMCCorMet = VBFMetCorrector
      {
  	InputTag CaloMetLabel = corMetType1Icone5::testTreeProducerJPT
  	InputTag MuonLabel    = muonProducer:mergedMuons
 	bool MuonCorrection   = true
 	bool MuonDepositCor   = true
  	double MuonPtMin      = 5
  	double MuonEtaMax     = 2.5
  	double MuonTrackD0Max = 999.0 //PG not used
  	double MuonTrackDzMax = 999.0 //PG not used
  	double MuonNHitsMin   = 5     //PG not used
  	double MuonDPtMax     = 0.5   //PG not used
  	double MuonChiSqMax   = 1000  //PG not used
  	double CorrMetMin     = 5   
      }


    module hwwMuCorMCCorMet  = HWWMetCorrector
      {
        InputTag CaloMetLabel = corMetType1Icone5::testTreeProducerJPT
        InputTag MuonLabel    = muons       
        bool MuonCorrection   = true
        bool MuonDepositCor   = true
        double MuonPtMin      = 5
        double MuonEtaMax     = 2.5
        double MuonTrackD0Max = 999.0
        double MuonTrackDzMax = 999.0
        double MuonNHitsMin   = 5
        double MuonDPtMax     = 0.5
        double MuonChiSqMax   = 1000
        double CorrMetMin     = 5   
      }


    module vbfMuCorZSPCorMet = VBFMetCorrector
      {
  	InputTag CaloMetLabel = corMetType1ZSP::testTreeProducerJPT
  	InputTag MuonLabel    = muonProducer:mergedMuons
 	bool MuonCorrection   = true
 	bool MuonDepositCor   = true
  	double MuonPtMin      = 5
  	double MuonEtaMax     = 2.5
  	double MuonTrackD0Max = 999.0 //PG not used
  	double MuonTrackDzMax = 999.0 //PG not used
  	double MuonNHitsMin   = 5     //PG not used
  	double MuonDPtMax     = 0.5   //PG not used
  	double MuonChiSqMax   = 1000  //PG not used
  	double CorrMetMin     = 5   
      }


    module hwwMuCorZSPCorMet  = HWWMetCorrector
      {
        InputTag CaloMetLabel = corMetType1ZSP::testTreeProducerJPT
        InputTag MuonLabel    = muons       
        bool MuonCorrection   = true
        bool MuonDepositCor   = true
        double MuonPtMin      = 5
        double MuonEtaMax     = 2.5
        double MuonTrackD0Max = 999.0
        double MuonTrackDzMax = 999.0
        double MuonNHitsMin   = 5
        double MuonDPtMax     = 0.5
        double MuonChiSqMax   = 1000
        double CorrMetMin     = 5   
      }


    module vbfMuCorJetPlusTrackCorMet = VBFMetCorrector
      {
  	InputTag CaloMetLabel = corMetType1JetPlusTrack::testTreeProducerJPT
  	InputTag MuonLabel    = muonProducer:mergedMuons
 	bool MuonCorrection   = true
 	bool MuonDepositCor   = true
  	double MuonPtMin      = 5
  	double MuonEtaMax     = 2.5
  	double MuonTrackD0Max = 999.0 //PG not used
  	double MuonTrackDzMax = 999.0 //PG not used
  	double MuonNHitsMin   = 5     //PG not used
  	double MuonDPtMax     = 0.5   //PG not used
  	double MuonChiSqMax   = 1000  //PG not used
  	double CorrMetMin     = 5   
      }


    module hwwMuCorJetPlusTrackCorMet  = HWWMetCorrector
      {
        InputTag CaloMetLabel = corMetType1JetPlusTrack::testTreeProducerJPT
        InputTag MuonLabel    = muons       
        bool MuonCorrection   = true
        bool MuonDepositCor   = true
        double MuonPtMin      = 5
        double MuonEtaMax     = 2.5
        double MuonTrackD0Max = 999.0
        double MuonTrackDzMax = 999.0
        double MuonNHitsMin   = 5
        double MuonDPtMax     = 0.5
        double MuonChiSqMax   = 1000
        double CorrMetMin     = 5   
      }

    sequence vbfMetCorrections = 
      {
	  vbfMuCorRawMet
	, hwwMuCorRawMet

	, corMetType1Icone5
	, vbfMuCorMCCorMet
	, hwwMuCorMCCorMet

	, corMetType1ZSP
	, vbfMuCorZSPCorMet
	, hwwMuCorZSPCorMet

	, corMetType1JetPlusTrack
	, vbfMuCorJetPlusTrackCorMet
	, hwwMuCorJetPlusTrackCorMet
      }


    module rawMetProducer = VBFMetProducer
      {
        InputTag metProducer = met
      }
    module vbfMuCorRawMetProducer = VBFMetProducer
      {
        InputTag metProducer = vbfMuCorRawMet
      }
    module hwwMuCorRawMetProducer = VBFMetProducer
      {
        InputTag metProducer = hwwMuCorRawMet
      }


    module MCCorMetProducer = VBFMetProducer
      {
        InputTag metProducer = corMetType1Icone5
      }
    module vbfMuCorMCCorMetProducer = VBFMetProducer
      {
        InputTag metProducer = vbfMuCorMCCorMet
      }
    module hwwMuCorMCCorMetProducer = VBFMetProducer
      {
        InputTag metProducer = hwwMuCorMCCorMet
      }


    module ZSPCorMetProducer = VBFMetProducer
      {
        InputTag metProducer = corMetType1ZSP
      }
    module vbfMuCorZSPCorMetProducer = VBFMetProducer
      {
        InputTag metProducer = vbfMuCorZSPCorMet
      }
    module hwwMuCorZSPCorMetProducer = VBFMetProducer
      {
        InputTag metProducer = hwwMuCorZSPCorMet
      }


    module JetPlusTrackCorMetProducer = VBFMetProducer
      {
        InputTag metProducer = corMetType1JetPlusTrack
      }
    module vbfMuCorJetPlusTrackCorMetProducer = VBFMetProducer
      {
        InputTag metProducer = vbfMuCorJetPlusTrackCorMet
      }
    module hwwMuCorJetPlusTrackCorMetProducer = VBFMetProducer
      {
        InputTag metProducer = hwwMuCorJetPlusTrackCorMet
      }


    sequence vbfMetProducers = 
      {
	  rawMetProducer
	, vbfMuCorRawMetProducer
	, hwwMuCorRawMetProducer

//	, MCCorMetProducer
	, vbfMuCorMCCorMetProducer
	, hwwMuCorMCCorMetProducer

//	, ZSPCorMetProducer
	, vbfMuCorZSPCorMetProducer
	, hwwMuCorZSPCorMetProducer

//	, JetPlusTrackCorMetProducer
	, vbfMuCorJetPlusTrackCorMetProducer
	, hwwMuCorJetPlusTrackCorMetProducer
      }

    // ^^^ Jet Met Cor ^^^
    //------------------------------------------------------------


    module muonProducer = VBFMuonProducer
      {
        InputTag g_muonProducer = muons
        InputTag t_muonProducer = trackerMuons
      }


    module electronProducer = VBFElectronProducer
      {

        InputTag eleInputTag = refResolver
        InputTag TracksInputTag = ctfWithMaterialTracks
      
        InputTag eleIDPTDRLooseInputTag   = electronId
        InputTag eleIDPTDRMediumInputTag  = electronIdMedium
        InputTag eleIDPTDRTightInputTag   = electronIdTight
        InputTag EBClusterShapesInputTag = hybridSuperClusters:hybridShapeAssoc
        InputTag EEClusterShapesInputTag = islandBasicClusters:islandEndcapShapeAssoc

        ## Electron Isolation
        double coneRadius = 0.3
        double vetoRadius = 0.02
        double otherVetoRadius = 0.015
        double ptMin = 1.5
        double lipMax = 100.
        ## double tkIsoCut = 0.2 # -> not used ?
        untracked bool useTkQuality = true

      }



    module treeProducer =  VBFTreeProducer
      {
        string SampleName = "qqH"
        double SampleCrossSection = 0

        string ResultDir = "./"
        string MiniTreeFilename = "MTestJPT_pg"

        InputTag vertexProducer = blub
        InputTag trackProducer  = blub

        VPSet particlesList =
          {
            {
              string branchName = "electrons"
              InputTag src = electronProducer
            }          
            ,{
              string branchName = "muons"
              InputTag src = muonProducer:muons
            }

          
            ,{
              string branchName = "rawCaloCone5Jets"
              InputTag src      = rawJetProducer
            }          
            ,{
              string branchName = "MCCorCaloCone5Jets"
              InputTag src      = MCCorJetProducer
            }          
            ,{
              string branchName = "ZSPCorCaloCone5Jets"
              InputTag src      = ZSPJetCorJetProducer
            }          
//            ,{
//              string branchName = "JetPlusTrackZSPCorCaloCone5Jets"
//              InputTag src      = JetPlusTrackZSPCorJetProducer
//            }          


            ,{
              string branchName = "rawMet"
              InputTag src      = rawMetProducer
            }          
            ,{
              string branchName = "vbfMuCorRawMet"
              InputTag src      = vbfMuCorRawMetProducer
            }
            ,{
              string branchName = "hwwMuCorRawMet"
              InputTag src      = hwwMuCorRawMetProducer
            }

//            ,{
//              string branchName = "MCCorMet"
//              InputTag src      = MCCorMetProducer
//            }
            ,{
              string branchName = "vbfMuCorMCCorMet"
              InputTag src      = vbfMuCorMCCorMetProducer
            }
            ,{
              string branchName = "hwwMuCorMCCorMet"
              InputTag src      = hwwMuCorMCCorMetProducer
            }

//            ,{
//              string branchName = "ZSPCorMet"
//              InputTag src      = ZSPCorMetProducer
//            }
            ,{
              string branchName = "vbfMuCorZSPCorMet"
              InputTag src      = vbfMuCorZSPCorMetProducer
            }
            ,{
              string branchName = "hwwMuCorZSPCorMet"
              InputTag src      = hwwMuCorZSPCorMetProducer
            }

//            ,{
//              string branchName = "JetPlusTrackCorMet"
//              InputTag src      = JetPlusTrackCorMetProducer
//            }
            ,{
              string branchName = "vbfMuCorJetPlusTrackCorMet"
              InputTag src      = vbfMuCorJetPlusTrackCorMetProducer
            }
            ,{
              string branchName = "hwwMuCorJetPlusTrackCorMet"
              InputTag src      = hwwMuCorJetPlusTrackCorMetProducer
            }



            ,{
              string branchName = "allTracks"
              InputTag src = TrackProducer
            }

          }

	string use_mcInfo = "yes" // yes / no


//           PSet jetFlavourIdentifier = {
//                string  mcSource            = "source"
//                bool    fillPartons         = true
//                bool    fillHeavyHadrons    = false
//                bool    fillLeptons         = false
//                double  coneSizeToAssociate = 0.3
//                bool    physicsDefinition   = true
//                bool    rejectBCSplitting   = false
//                vstring vetoFlavour         = { }
//            }
    }

    untracked PSet maxEvents = {untracked int32 input = 100}
    source = PoolSource
    {
        
      untracked vstring fileNames = 
        {
          #PG H210@CERN
#         '/store/mc/2007/12/11/CSA07-H210_WW_2l-1197355886/0025/0C1B6C2E-D6A7-DC11-A89C-000423D991BC.root'
         "file:/home/ws/bd120/data/job_0_H140_WW.root",
         "file:/home/ws/bd120/data/job_1_H140_WW.root"            
 
#	  "file:/home/ws/bd252/data/job_0_H140_WW.root",
#         "file:/home/ws/bd252/data/job_1_H140_WW.root"

        }
        
    }

    module printTree = ParticleListDrawer {
        InputTag src = genParticleCandidates
            untracked int32 maxEventsToPrint = 15
      }

    path preparation = 
      {
          allEleIds
        , refResolver
        , electronProducer
        , muonProducer

        , vbfJetCorrections
        , vbfJetProducers
        , vbfMetCorrections
        , vbfMetProducers

        , TrackProducer

	, MCEventProducer
	, EvInfoProducer

    }
      
        module saving = PoolOutputModule{

                untracked string fileName = "allVBFProducersJPT.root"
                untracked vstring outputCommands = {

                        "drop *",
                        "keep *_*_*_testTreeProducerJPT"
//			"keep recoCaloJets_*_*_*"
//                      "keep *"
                }

        }
    endpath outpath = {
                treeProducer, saving
              }

}

